const vm=require('vm');function generateScript(a,b){fixBytecode(a);const c=readSourceHash(a);let d="";1<c&&(d="\""+"\u200B".repeat(c-2)+"\"");const e=new vm.Script(d,{cachedData:a,filename:b});if(e.cachedDataRejected)throw new Error("Invalid or incompatible cached data (cachedDataRejected)");return e}const readSourceHash=function(a){if(!Buffer.isBuffer(a))throw new Error("bytecodeBuffer must be a buffer object.");return process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?a.subarray(12,16).reduce((a,b,c)=>a+=b*Math.pow(256,c),0):a.subarray(8,12).reduce((a,b,c)=>a+=b*Math.pow(256,c),0)},compileCode=function(a,b){if("string"!=typeof a)throw new Error(`javascriptCode must be string. ${typeof a} was given.`);const c=new vm.Script(a,{produceCachedData:!0});let d=c.createCachedData&&c.createCachedData.call?c.createCachedData():c.cachedData;return b&&(d=brotliCompressSync(d)),d},fixBytecode=function(a){if(!Buffer.isBuffer(a))throw new Error("bytecodeBuffer must be a buffer object.");const b=compileCode("\"\u0CA0_\u0CA0\""),c=parseFloat(process.version.slice(1,5));process.version.startsWith("v8.8")||process.version.startsWith("v8.9")?(b.subarray(16,20).copy(a,16),b.subarray(20,24).copy(a,20)):12<=c&&21>=c?b.subarray(12,16).copy(a,12):(b.subarray(12,16).copy(a,12),b.subarray(16,20).copy(a,16))},runBytecode=function(a){if(!Buffer.isBuffer(a))throw new Error("bytecodeBuffer must be a buffer object.");const b=generateScript(a);return b.runInThisContext()},runBytecodeFile=function(a){if("string"!=typeof a)throw new Error(`filename must be a string. ${typeof a} was given.`);const b=require('fs').readFileSync(a);return runBytecode(b)};module.exports={runBytecodeFile};