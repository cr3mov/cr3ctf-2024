from Crypto.Util.number import long_to_bytes
from sage.all import *
import gmpy2


n = 16030576947023400065618286009673489326938037507005457008877167589622714183051087160174944130439955565579395222956887695840814631199317765424080444818391777992147600034485627610106599482101898584352235397803180592299215337528626744939087470206838085556602002380172661652140214358045557704232302608391095816660724707741179833024369631802537886134822257916939111578171792385909038777719602692711889483375190006436296684468886991939855329217178219337550984026265972246895423493139074968752326547799727375079177851471325389270966872563972942351340633783606430494736917620671302261613037447669475408519891579065572725611429
masks = [5604669618464592137410046543599541440443357710954519240506114911297968392645094609193581668701714308207593513319873920257558827972715211344454460152993799016074611883380547788906708939860321105069835267291200788832588088872839061723883779057711132631574725144092263890337348191575414337193338035033895864429783026840884527662410138375309567348413251559723921619273639137339107436016269616228731437579376169469809206687198285870491886474219136679355331553132369799961195100540859507829700323053327724282479466184979157440057448801059332169786139980896591685229510034909289570533722034283183060982650472514006206166510, 12592725100995384265955081462681274401614588261440733333601036062002436251099994646223714430162077653388234679617293768852738397216452607790461851527547079691796860955276451545678498216578035330719852921653928751599253884058014554561273671395888269596383824142493088210347243789320553169651837434850566224158725586880318346152430512170486182782862347368544079151050227502571201880032946964530858782001389107440561365148110353809870393941256711327172948150535967022937128830756608679271412867181263349832873006682587051782859700330180720773339887442341075348497597385855994794310443063154726550245676921269662434327200, 11648533328440160609616174773771267986457925718352957976059634271890708507423463865324134231167449137324312472903412132228932100524695698306857507368081454862093212635645822512534729554823270599706713091159274474351339260277899114827236952165815585719444375970895028720880985399185692815582313636844720888123940021612532419313198249665222243625953932984789670008733771780972748917876685182550135317725290890843995812455507632508979913435579539778098248275966566469586147150468337531064523202708091725188712514741269727080480136682273066026450179818025049727985071871263954425148076395804451563209085241184085517912266, 5675494370231692782281432201440723772915265663919947920976837208674953878054528274845828558520841006367534454187490916464874759363206524062005551710897894795071310557528065018878358754342777520474242980547151268299589823593628692434687938857002574807164911570203599698016194051181328100049469290684781809704380765462207059270876119025023688065400542836671155693017376081834727794446510158143399110739220241550303986798250118050527199379774016346710317608342056125105935434423988118309347548586799564211212289439261086270554782891129097039005398045089664925637397962136155544539655816189506185004114902329444279687416, 1353902555156470775228385397695448212957959791853782999949058056287162549835216864592703570433545057544685592824722796873946294625298265627913802257997402829042578899978391548102514899923462184410282194030041988445625441265852356166444601263409792748829314057954552802810192522300360238249509135043860699562491965156835175959788344380011032205676715468023658602297393679613450019404873795678480927029760252611559773005187074689323125980116313688709515694661949236524839598610187787764785107455749463536095038515136978158306659472257667357600106991956171730311368265704898990963366779789793436298366603898880606486812, 16069691645012371279992992328636540738862496271272152684674097442784968516630059448046568741937727599261123017546903793606096533792409173543663858563750143795621771852684960754177366818384737210495763995447195319196180804304930634682534843958951261682657065097282017110334892025536622774994291296816674729353825295047603567521914395758827543450398388338556942998999548711094482807778795450848194822376385777496279949265205715945569520434790682103583526718373424193644809792518625375426587273689703091410754942889938626756946568390532816727961169147497447106423700386994122389036488732349504978001439501160718861722779, 9488646079232030744786459831940078570949128825301116258578857041568721501501623841013675321165454490893589757038800772336385962038364703697195748455300198238290608245749256235085891568622756821860059817660039547972290160932974387694282916017314147808878637186443051072245905649013745893656064123706474017987084768013444607200847515520107912023129134083259825022809776118871910713699639496592056798913582812701052330889767969537936336801044352879878660584758716838117336717991518828691223584747982406594771670025185402298606942828316211458507446514397734032855070588425409076018217928047356711177120496624251317090920, 1005701827801442449955321960924464619833960272801537382932329929715079594047931058463826183631622547585759771727952914259131114231432449822133481246834794402487459641695611688971162476343141272641546461331225476464844388555911761077848464327036569555353085277060934000807060490282131296785831575211160530109029697185715213147005119958495634145551077921689261552922638282827869449902669210854869160286949173848926756321161569326125604319788630140148920785100737101393413909302969216410369600940329558419536035752884568728174545903676761277069070580554132334642272268229867360120639958148342301717478755654433771341937, 15301328299203962777919947343638913265018327896463916423299765958739097377448046549291587990304904363301510895995371932018073366726505139686072409828050814552640043601116969730056323431040736262762260663570637831901033082379890214841055161424160035151583135261066365997685700754621569325387855187924850421132892282285810203616563013425984401470653150846600846136916321961111018570106826890861940721275967856093204344360649260230295125647108762703615418563999164504864024637206386315350989738617600072075123892887190451447306643597553414183488815353227796936598160327539993942155014694871116947588189990870777092653389, 6798081736662022590764846365373558415437742877136226903055556044287737020194840622543211303240818669991308245526906943673936169763740137245359030073759665332346963333864454984917257900934918114657599224111298519698158033824886491887164971543176649041041236441346974514206848356830364348119360145617306749641201521939656402468574150707318445051076821395708930592083828106120045141372893882376991852254097311001577949096736200049357189535844967436862324667680739414637204211474428968095360603456416667361472367891251874162137312502786804642599200780751109558418034472738969197607455169940962484852642246604121503052400, 892713933469689243095918679123646093617761328715748279126798829239986962663982252773481699776710090665601402210436971621660949311671895664842687099829539466827735887123590438461276002109794052111199764959795752965958307819336636623841006620708802827581752768736465333350237230966390609483803446692790568131874295906828562277985437206551394104164934845998178326887021767324577664485808646655479767072278302337167023802331329483829886964123623228718348859709132892807675484668752647399020460977117987515328249390830983597255427237640387412259276505360628226561655962747605856316348102739442950934571897767967627349642, 8177921504495103108527666009626013898727534330268142775719718952531710989539197115501372543847363106704794148805081696758486443273110370410326592673431817875365059601942010902986409366193660037496500184319659619458273620776644097585341854044466979621184573313290352826427745316508241058529005072491226189168116631232249744305901046187420611250382618865587513244971336744212325285349771972798464689887847399497014567551142465470030430586270777144649011574628535270115871762454425021344384916364112065122233270833443116470654617696389822870014164123641529666449734009551188551336289979712753055352225373004709055516394, 10632195104960328110777261951049437862672098802206388062193815324501694538771127896465086274372645998722046751845412178363667321328111433558175069756349948934183825420106645181374693566720790168901350391306626620076203586189650877742256757457861605658386279853644013255014195453880139968892641279164577370621667103807758716072728115967879055726764071869880735880249244518269123526795542556105163761994648008658363201495581645630295803706536767764291460131645940011515882218575567233413730361478777706964802355748121597312544236291906847524427243803010720301981452889105491884658125972631772643780475584419936545661166, 6700208199271103015710053125902442828685519878606724011656701694336285452425024373978740119612361030867294145604383004096525235284863422963972064514058122696338442363658469683236363060734476097303233265674438043411282323385834830891553222093200261873022933606732845341798521823212126499912576827457042451516018457720801791536738444635869757105542352002876154180653514091958904208953769836015794994441603536403396560366786239586951531210780074090784915066219266919301859581767524196162972538038473786480663546502419876961440318898011465323701498003456003949736604619920862360582741000619589048625182881588627953082116, 1607063079916877834303719428345588388225850962459161794320336136455564411441580338911341773498726409185947230717893194518371026963841317929841350378831055853224418198979201764476371393735887226211399216990523149156108535356380042975844429297480307902501236397381490868720696962772024622811939990245409180910593528808249078048270140689044338007550651593513973901165820850932824248698841954805027533540660997440231146222561883630551833923637422336552806013631904161946195348008343457504184092511030572899923990262133063781288455532578839615178105577243357173568665757535625027486852773078452803142532489967308958997704, 9155445382661129530075122483500351410955455934325369113486891665116186414138693389609143410218409362542155131349770251091906259047640137620831905303006850037532428402957680175979912699830321024693869325582252545262637931661182023770876083750199310718408212723524314066777540825910787408335439914741278061385681032860559819398904663325046455342017816904218160464963144061303718545783421565590825407722427705164361534717446559709482146639198157266276281750692736690842959345559174745812012988691729100974929945798052951580684067617981999824331667839154349397505679905217081516950677423854371934108583021452568623607742, 7566878189345455998574745394952220273698856893668155704247853929061511832561006427171679110911148069909290150791409643063247135880202154317123631644678995165031974709936544627411761916053887421819564778010167031022159866141838845211735544112833053666254420171652680745286747387488732282086702764170043883652496458302121726469513514049892826712883446526624962766278995185176849105035365446257825852511034491922582461875955178903175092249669228465204837189546068879372731309881715629467451163907212081555773951262583711954072195516347335518556513341133888213583653773403012224462992348459716359751726223089638017537233, 15089293607479353738679937361488023003389438287570109116066598676547692970607666158173025563141591102996251802938846466602038976152052158378452069876528070089417992002541510358380101840628754246636821527911893033963368595025658559129197649458025721063119079205775070917044110800805751208324135621413468596201059395216079531292047804354717224023242136984237473701161603754861807983828283618515289196683993995462734820551731727115407450617755581543257178068424067906463641436311217595694716144342316762991271417984023293353936458289888045666265334295421185238612218179188018887235245246378485566963950151119721710627233, 2345411161046161772398787132930354503992529025314123798034847988368054895275926767688026511413617534464047316061789535943417503634935248468271676408242629009886610434013295890058531754900882006751620148433462832149701292126754927105362647997195317985317173716624277893432487414186812008303911706245349614361830046319948886060330712874845080978645383594752460039607993685720267822228317322315389129736382834810693858653437375028245415973818851941609873170164398817114015107744676596164849131035937024050376443088210124067526117348515157140300651533378485570004280195656767699781229805220728602525209169863926918499623, 13259692178555792942032229105873159956087908907519622055130777896898216496469506090204043238853820928842922454698629996341816164607855496615116117496050725874852030267661760326564767680263216833772731914872672796590030002521426243867673934096131866599793754047466207550279013051549459853772135890667582114998738689298210996571184174384674653048050727216628346056214759714651629721273902577024256181630566599747669944785602049166579129751948110775265160685618387206839750708552340671606673609338334231407295683451711017816125949679992279558571215606008197600744871064911797276819441940661214432715327623290484080733753]
enc = [14441931295315820982534486067773200926891366588389066905704690425574350901447249367535948004807949169934502033278843732157016216259238574342882258640628783032546317445992689328955077023247365482424893224278867225412099139897264233921643755597636323803257381085697457594752657270734651155792700583193944966904139132730583788725645026687727489587876317196535604558130182663877824744314325329858645805129364083945621220431281228256321971500093126799363419166339348993495865251746051601337186453039657948871943960239525528294459034045533977319105164338046685438436549855529433029869527611657308024626570561641076411222357, 2204273082566490077887439663061099757411195317340888243150349198292999165064739069513572842175165073779513878167036301043056556724721328728992261360339602238803146602733810836304500913323245041145156912264343541275263764896720710076460540403211998573720992633072645931036437749892201868883968536201417905021000157562551629925924230545613256799782633180784438929709701704587486824635361451180325786979681772522899596181170477358379844703377194886352766840998370605559828096598213143091096385361265601734433327778883681556451774779349599570031392525965975117613786297425443482542135257364609389940470323667734786210147, 2170573762156656401614819681066391931064506713580052519711076782995807258697510134579432182003918376686208165986508308200155621591747658872238933345354506691671287484924947931019566777232703124912855065390712309470265222452228003118437308246684263150884566177645363221399217268142271539101857656622344328555703550051765054447011113187280892370774426497187000738250422351181505458230253119042905903907196661235775416055324097553404085237545581367966068010086137344178024239295735012318333324899522187653442092395517737892690051574389534893412199815489900328886798329518934583346854499930432066307633736127823202135423, 5188084417830588897425832449765956611756414258268839134389608440725938961395320033874633242600225243206094660961968438690450825695741073529186554720768556790346594357324204977262629638860569688205045837534712724931611125563928767519157579532223402193544087480119643249640898945088152698689064540877864135034989729454987681559267538411768861498422685274213173212664461286780688706962853242731907587148190097605708542704826992317307236694286714036264386757693432490446348137559074096264603297162385367180243282175704031667921188956114998304464416983299128497058216419465475472151898646732538080971972948643886600047929, 9868575866663839857398973700594983785193540120081950622745968085124599074371404040846915778427956884752749960478676031531671982646690486439434963329860530051594450375490294511177998189568269872767023629184996108614307808776208162631989448417460792509191445661627329264997538718301349912229639612229733911655225083102408717401603953763823173893209557862126726895430294835626663114735431958600296198298823833401076787168539612079008287877879450071866421278074344817548224002024647712136304702591218121814091588270108494581364936566642448247731469595064368626422028221804353870656854813872835578629473529505414174537070, 6857259540475936589073969001395832277864498636892944816415616395883582083622482044960698392166860348822298508545964870358130912065678661605921397050435653889642098380420574390997877518724978943864781302620670551556623800796887543726113996964484026780583038935101117593711786476691299404301784705952278750011436735694099950535335424134903182642807484681156699044018161441172320259816978307909379815407394924211583227892300796817201996375325086122019346267750355098253385729135084915480851666424477954343268622037227971403483905780349275592204007552393510160334758984006362241526930350083172544095398907803947108977058, 7523662232619109919129370821552862899818547340231555669326485348102678644305424242476399921799137955638380738872995932149989166684724283668663068498925908247531766002300501240781567538416912504551245503275575749554021588630112182030605799834544938795763885837165609835778953511436562355225014142302102335549833265690870610357015195382740429660751817379325458540988483014669890638660053556215283858200419032791467481728948648647337610418466086171206827409073797961375507152882058641085894298789707164456052408356092314917816352151723194090468064386461998797627372685447969911864952523521390482994961526999246899345646, 72353393333692313714509043115156050279855489940091392851006412793185094631015124621501252673882585168297580086605560525485389211689024495503235644905334921053602157621693234770437986824620832574035903955676519644446339032819865744938719777332166823739272466729963995969258844964040091175603688058212465426835532646836056872614876467520198584654460742444576056728708792859403811329289060357099078335508043434166978759475997315283457566080406869977419114273663579028589534104972407114413288298394246630751173011781758967716078072949682653462095151585338634663284415033412079747778636538910334824574534513277087710092, 7896005301106946506316660394073046034646372668032548872631329743786372298731800395109075780150240377657676326639354520412959073501969359827953054205301432662469511454175809788429742414449269291873214919953355824849930355335671051663376046412226945701815968889890358714173412548908563731314089176584484804071630169898221021430813860708478664733921340037882681441572636647917394698270925141561724167058962365893347602801992295567072525757837901905239969285551438114566296979298897305024095876972343344697793527719305436191916078390118171021443507688216600169695612151777921184410180486297944426534653362503422341596754, 7506389592763389787598336669196050234288610789922119675075423674557282726047076384043826614258441791725491540204398106362926853356325912264569621697086054102869907848645183672523202803587044208062700198524201340919570821005122291159018668386466785406214935224141667434508107833960678141781037552241938279420534235526707022376035723458492370218644010241533915490316272478620649649450083868754195817423908533781639535607181142730876848565528174841419192802377963160885780789688116037200016584113745027616751099324308392991179328544546974253680467964436066508086970924833146352280315180853834703286428906648803013622709, 15092517584395165731516481819745352728211688074463543902030132489798990235599308319589363769347244499596051732787338084150785006665571856861787596544661644432781749307234652015287517053471999603669298239211048835915558396391087040376678317733277477875619345361892460188014144000260584692368191338863980481854613533727089815846669153682910708543280877957209092365860866004152927237380191491160461098207051590561273801549333622123279149025814236508283396373240279566170431531772207862157878377081455697890328480306892857565828991355168317163312105882654851361175906553172761326698930729579718744722912553516991287893816, 15241869917518721765584172985965286955817844348004546669679943489018204656467694225596177334596120666303810027516550407882520841921457919091609631990129979993953799859539077226249256188660942113465275710350042312601142825833357874843364872039381492479120071481046405053954209736435048492536881583279482672672594649620534769056597635064889704104703797698379905675421079417738707612571625021745611349061484598772141883298496796830372319373553348423667663794414211419640492052505625426910566795022822438112479590672092077369008844127626807416014670494705262095698808954420411692601067458588611441597071419962707091844683, 4982795092583471607831003645052145020933649858477427840744254954242506438461152013924398384722529801991326983793354942497332438211445833288748947481692943889482824358631626365098938674592713616817666741453160233444153089088202709366603500327942282832372431705619136425749669970266765114884368379146665778763601526766584067231586458870730324646623316796535777722038086575649653817050711982904950199867834620909129677935279354837788485116546062317324416136334825870493050436508886565150835853614522649345551667439935423695100236805120467381744408119307496268048765988144378426252009064349589835923244452321380808948570, 9124376486669124582728375319226451420310489569592024799153483533121863804892355346892277015791182522341210093753236346206406352511620995619453433065224681391882867646678584629190419586385071878421475415838364536882798282990042449768534336694172354889870794321126082246799086476979596053103066740327046129661323754608689232608147565588334602385951056294058782778635223618436090524139611391761581541045188943383192287413984252114326422687707935918800057624890374559903289869376545300295716982205341503042836659255094232669351235247401460854428486166324303538593268935050331685845264115721164008244881389218970536903010, 5707633754504670430672546784527943619273924244094841369381131051390978842554356159922287663736065173072817887295057971310533562765383347751945203853644518609367135812253390570700997827267782228019029549013438614466610940279735031750507458782478152514754565930971192353946229671322249522215860852338989712676915365831928584652203512585266293532554562716808670419506556678134316030205155118994748737165022660551593908888692680925290985283246775412383399692217767626937097362433275697126115908893999993874554612590174681562543533615930920939517909085811359022628300802548691558930223396843267226786434512238386734454601, 8475588988000318959162853588880442887312545869531587477899798286649147993924007678407809319837724017462346954596105243360089545044938730847755403408811161951364155305096669898158785272004997645946286407239462925858031246872882654188081819212792572871470631378222806668469921378130283449230555106763500497782613483900134612646546371802011322999346921767405172347141815788511391987486743694028154581537318229731009351117576547526169355528448531710865558480352302841566506995158094331121933958602094800617302591816775543810135686386166308296599993619756762774919390571890287415231067533852306487591033076107177611518171, 6444883495509472091411763690191390304985198539477071726114647958145140724389726268181734241814477539958285382026947561633946988887874756256979597513532912663623737708964344445629556707752299601089319201465941529690371155017171465621552703833282475946715817910647461383659583906796000117402496820974899289410159180420669111506964071518259291084238985545511275194979088054776919448096335004723831654468972896921905972500639270786766139203969094112440306609878874746363339821442894144055496485910273423381988844564351933088560680453569288380535879105094159628378391188822378182721953746426375017619629263471158426605613, 788347530209335612558261948161142021144126040046251398772375273584018665385810626126174552410012433633198532899899749572629276080548759021378504198951483810578248971505366038595695417177645296577468647942135750102328536169306326846167909145794259298306272103872837249300339986447536025439593241218353273062574189031203483968203257929690605913078709960156588097514971192220035055440853721921656939750643903697544136260324057694947056186741693886502391901131469776249686414403040888529644549368536175155034938648946628229032053168330559149438583225971329445381490050359001651635562156117921546928683816819671004483693, 8263804151283857140604647721201919111289502725353416559614956578112567573362021085660158415023278867233728381041971248860694626561620780074123584100547072201331961431295862383865411749217051663653439087877027593187911960875159761648445852364576098851653298369114548749298542095801121886289014044821791753369184780880355340950950795213874977597460186184797437232994977125708869255316036180958959036297019586442545167889369805492934884761098485690459125626336175213162085048074000506538372306327577485090942988047739964205608587373957092668256021499158960290100052198762672160943981728917730649703908366913693287883513, 11592093108914466381389506510055812042580176837661440008941779335734394306934466967012432993328849573610620206791608697749725901279843593303727692918453595002929890535419079942315783408529492943391841435696994801864643670408865756726580567990606775499713750514285181798883413328476848449620680966443942402380188457406800197368823044854056845787324423562374644384448938627072338710230803716721815005680520977938581145210580975750062539751621180306864701672910930343672134270407309626156603392559262063541876390041211344173059202711537420234796738338701078408170881560011831259572537614980492649982378521227622605290468]

x, y = PolynomialRing(Zmod(n), ['x', 'y']).gens()
f = []

for i in range(len(masks)):
    f.append((masks[i] * x + (masks[i] + 1) * y) ** 17 - enc[i])

mat = []
for j in range(20):
    row = []
    for i in range(18):
        row.append(f[j].coefficient({x: i, y: 17 - i}))
    row.append(f[j].coefficient({x: 0, y: 0}))
    mat.append(row)

mat = matrix(ZZ, mat)
mat = mat.echelon_form()

flag = bytearray()

# compute flag1**17 and flag1
a = -mat[0][-1] % n
flag += long_to_bytes(gmpy2.iroot(a, 17)[0])

# compute flag2**17 and flag2
b = -mat[-3][-1] % n
flag = bytearray(long_to_bytes(gmpy2.iroot(b, 17)[0])) + flag

print(flag.decode())
